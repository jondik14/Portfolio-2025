<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Room — Luke Niccol</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../Logo black bg.png">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    
    <style>
        @font-face {
            font-family: 'Cirka';
            src: url('../fonts/Cirka/Cirka-Regular.woff2') format('woff2');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'Cirka';
            src: url('../fonts/Cirka/Cirka-Bold.woff2') format('woff2');
            font-weight: 700;
            font-style: normal;
            font-display: swap;
        }

        :root {
            --font-sans: 'Instrument Sans', -apple-system, sans-serif;
            --font-heading: 'Cirka', serif;
            
            --text-xs: 12px;
            --text-sm: 14px;
            --text-base: 16px;
            --text-lg: 20px;
            --text-xl: 32px;
            --text-2xl: 48px;
            
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-6: 24px;
            --space-8: 32px;
            --space-12: 48px;
            --space-16: 64px;
            --space-24: 96px;
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-full: 9999px;
            
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Light Theme */
            --bg: #ffffff;
            --bg-offset: #f8f9fa;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --text-muted: #999999;
            --border: rgba(0,0,0,0.08);
            --surface: #ffffff;
            --accent: #5E6AD2;
            --accent-soft: rgba(94, 106, 210, 0.1);
            
            --status-read-bg: #e6fffa;
            --status-read-text: #047481;
            --status-reading-bg: #fffbe6;
            --status-reading-text: #9a6700;
            --status-toread-bg: #f7fafc;
            --status-toread-text: #4a5568;
        }

        [data-theme="dark"] {
            --bg: #0a0a0a;
            --bg-offset: #141414;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0a0;
            --text-muted: #666666;
            --border: rgba(255,255,255,0.1);
            --surface: #1a1a1a;
            
            --status-read-bg: #1a3a3a;
            --status-read-text: #4fd1c5;
            --status-reading-bg: #3a3a1a;
            --status-reading-text: #f6e05e;
            --status-toread-bg: #2d3748;
            --status-toread-text: #cbd5e0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: var(--font-sans);
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
            transition: background var(--transition);
        }

        .page-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-12) var(--space-6);
        }

        /* 12-Column Grid System */
        .grid-layout {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            gap: var(--space-6);
            width: 100%;
        }

        @media (max-width: 768px) {
            .grid-layout {
                grid-template-columns: repeat(4, 1fr);
                gap: var(--space-4);
            }
        }

        /* ===== HEADER ===== */
        .nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-16);
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 600;
            font-size: var(--text-sm);
            transition: var(--transition);
        }

        .back-link:hover { color: var(--text-primary); transform: translateX(-4px); }

        .theme-toggle {
            background: none;
            border: 1px solid var(--border);
            padding: var(--space-2);
            border-radius: var(--radius-full);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover { border-color: var(--text-primary); color: var(--text-primary); }

        /* ===== HERO ===== */
        .hero {
            margin-bottom: var(--space-24);
            max-width: 800px;
        }

        .hero-title {
            font-family: var(--font-heading);
            font-size: var(--text-2xl);
            margin-bottom: var(--space-4);
            letter-spacing: -0.02em;
        }

        .hero-subtitle {
            font-size: var(--text-base);
            color: var(--text-secondary);
            max-width: 600px;
        }


        /* ===== TIMELINE LAYOUT ===== */
        .reading-timeline {
            position: relative;
            max-width: 1000px;
            margin: 0 auto;
            padding-left: var(--space-8);
        }

        .reading-timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--border);
        }

        .year-section {
            position: relative;
            margin-bottom: var(--space-16);
        }

        .year-marker {
            position: absolute;
            left: calc(-1 * var(--space-8) - 4px);
            top: 0;
            background: var(--bg);
            padding: 4px 0;
            z-index: 2;
        }

        .year-marker span {
            font-size: var(--text-sm);
            font-weight: 700;
            color: var(--text-primary);
            background: var(--bg-offset);
            padding: 4px 12px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        .book-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: var(--space-8);
            padding: var(--space-6) 0;
            border-bottom: 1px solid var(--border);
            text-decoration: none;
            color: inherit;
            transition: background 0.3s ease;
            /* Initial state for animation */
            opacity: 1;
        }

        .js-enabled .book-row {
            opacity: 0;
            transform: translate3d(4rem, 0, 0);
            filter: blur(10px);
            will-change: transform, opacity, filter;
        }

        .book-row:hover {
            background: var(--bg-offset);
            padding-left: var(--space-4);
            margin-left: -var(--space-4);
            border-radius: var(--radius-md);
        }

        .book-thumbnail-wrap {
            width: 200px;
            aspect-ratio: 3/4;
            border-radius: var(--radius-sm);
            overflow: hidden;
            background: var(--bg-offset);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .book-thumbnail {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 2px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .book-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: var(--space-2);
        }

        .book-meta-top {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .category-badge {
            font-size: var(--text-sm);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--accent);
            background: var(--accent-soft);
            padding: 4px 12px;
            border-radius: var(--radius-full);
        }

        .status-badge {
            font-size: var(--text-sm);
            font-weight: 700;
            text-transform: uppercase;
            padding: 4px 12px;
            border-radius: var(--radius-full);
        }

        .status-badge.status-Read {
            background: var(--status-read-bg);
            color: var(--status-read-text);
            text-decoration: line-through;
        }

        .status-badge.status-Reading {
            background: var(--status-reading-bg);
            color: var(--status-reading-text);
        }

        .status-badge.status-To-read {
            background: var(--status-toread-bg);
            color: var(--status-toread-text);
        }

        .row-title {
            font-family: var(--font-heading);
            font-size: var(--text-xl);
            font-weight: 700;
            line-height: 1.2;
            color: var(--text-primary);
        }

        .row-author {
            font-size: var(--text-lg);
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .page-wrapper {
                padding: 0 var(--space-4);
            }
            
            .nav-header {
                margin-bottom: var(--space-8);
            }
            
            .hero {
                margin-bottom: var(--space-12);
            }
            
            .hero-title {
                font-size: clamp(1.75rem, 6vw, 2.5rem);
            }
            
            .reading-timeline {
                padding-left: var(--space-6);
            }
            
            .year-marker {
                left: calc(-1 * var(--space-6) - 4px);
            }
            
            .book-row {
                grid-template-columns: 150px 1fr;
                gap: var(--space-4);
                padding: var(--space-4) 0;
            }
            
            .book-thumbnail-wrap {
                width: 150px;
            }
            
            .row-title {
                font-size: var(--text-lg);
            }
            
            .row-author {
                font-size: var(--text-base);
            }
            
            .category-badge,
            .status-badge {
                font-size: 11px;
                padding: 3px 10px;
            }
        }
        
        @media (max-width: 640px) {
            .nav-header {
                margin-bottom: var(--space-6);
            }
            
            .hero {
                margin-bottom: var(--space-8);
            }
            
            .reading-timeline {
                padding-left: var(--space-4);
            }
            
            .year-marker {
                left: calc(-1 * var(--space-4) - 4px);
            }
            
            .year-section {
                margin-bottom: var(--space-12);
            }
            
            .book-row {
                grid-template-columns: 120px 1fr;
                gap: var(--space-3);
                padding: var(--space-3) 0;
            }
            
            .book-thumbnail-wrap {
                width: 120px;
            }
            
            .row-title {
                font-size: var(--text-base);
            }
            
            .row-author {
                font-size: var(--text-sm);
            }
            
            .category-badge,
            .status-badge {
                font-size: 10px;
                padding: 2px 8px;
            }
        }

        /* ===== MODAL ===== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: var(--space-6);
            opacity: 0;
            transition: var(--transition);
        }

        .modal-overlay.active { display: flex; opacity: 1; }

        .modal-content {
            background: var(--bg);
            border-radius: var(--radius-lg);
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: var(--space-12);
            padding: var(--space-12);
            box-shadow: 0 30px 60px -12px rgba(0,0,0,0.25);
            transform: scale(0.95);
            transition: var(--transition);
        }

        .modal-overlay.active .modal-content { transform: scale(1); }

        .modal-close {
            position: absolute;
            top: 24px;
            right: 24px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .modal-close:hover { background: var(--bg-offset); color: var(--text-primary); }

        .modal-cover-wrap {
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.3);
            width: 100%;
            aspect-ratio: 3/4;
            background: var(--bg-offset);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-cover-wrap .book-cover {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: var(--radius-sm);
        }

        .modal-details {
            display: flex;
            flex-direction: column;
            gap: var(--space-6);
        }

        .modal-meta {
            display: flex;
            gap: var(--space-4);
            flex-wrap: wrap;
        }

        .modal-title {
            font-family: var(--font-heading);
            font-size: var(--text-xl);
            line-height: 1.1;
        }

        .modal-author {
            font-size: var(--text-lg);
            color: var(--text-secondary);
        }

        .modal-note {
            font-size: var(--text-base);
            line-height: 1.6;
            color: var(--text-secondary);
            background: var(--bg-offset);
            padding: var(--space-6);
            border-radius: var(--radius-md);
            border-left: 4px solid var(--accent);
        }

        @media (max-width: 768px) {
            .modal-content { 
                grid-template-columns: 1fr; 
                padding: var(--space-8); 
                max-width: 100%;
            }
            .modal-cover-wrap { 
                max-width: 300px; 
                margin: 0 auto; 
            }
        }

        .hidden { display: none !important; }
    </style>
</head>
<body data-theme="light">
    <div class="page-wrapper">
        <header class="nav-header">
            <a href="../" class="back-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                Back to home
            </a>
            <button class="theme-toggle" onclick="toggleTheme()">
                <svg id="theme-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
            </button>
        </header>

        <section class="hero">
            <h1 class="hero-title">Reading Room</h1>
            <p class="hero-subtitle">A curated collection of books and resources that have shaped my thinking on design, product, and life. A physical and digital archive of ongoing curiosity.</p>
        </section>

        <div id="library-content">
            <!-- Sections will be rendered here -->
        </div>
    </div>

    <!-- Modal -->
    <div id="book-modal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button class="modal-close" onclick="closeModal()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <div class="modal-cover-wrap">
                <img id="modal-cover" src="" alt="" class="book-cover">
            </div>
            <div class="modal-details">
                <div class="modal-meta">
                    <span id="modal-status" class="book-status-chip"></span>
                    <span id="modal-year" class="book-year-badge"></span>
                    <span id="modal-category" class="book-year-badge" style="color: var(--accent)"></span>
                </div>
                <h2 id="modal-title" class="modal-title"></h2>
                <p id="modal-author" class="modal-author"></p>
                <div id="modal-note-container" class="modal-note">
                    <p id="modal-note"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // AVAILABLE FILENAMES FOR FUZZY MATCHING
        const availableCovers = [
            "12 rules for life.png",
            "12 rules for life.webp",
            "48  laws of power.png",
            "48  laws of power.webp",
            "a dictionaryn of colour combinations.png",
            "a dictionaryn of colour combinations.webp",
            "Atomic design.png",
            "Atomic design.webp",
            "atomic habits.png",
            "atomic habits.webp",
            "barefoot investor.png",
            "barefoot investor.webp",
            "Build.png",
            "Build.webp",
            "creative selection.png",
            "creative selection.webp",
            "dont make me think.png",
            "dont make me think.webp",
            "empowered.png",
            "empowered.webp",
            "graphic designers guide to clients.png",
            "graphic designers guide to clients.webp",
            "Happiness by design.png",
            "Happiness by design.webp",
            "hooked.png",
            "hooked.webp",
            "inspired.png",
            "inspired.webp",
            "just enough research.png",
            "just enough research.webp",
            "Knee ability zero.png",
            "Knee ability zero.webp",
            "lean ux.png",
            "lean ux.webp",
            "logo design.png",
            "logo design.webp",
            "never split the difference.png",
            "never split the difference.webp",
            "Overcoming gravity.png",
            "Overcoming gravity.webp",
            "Overcoming tendonitis.png",
            "Overcoming tendonitis.webp",
            "Practical ui.png",
            "Practical ui.webp",
            "rave art.png",
            "rave art.webp",
            "recipetineeats tonight.png",
            "recipetineeats tonight.webp",
            "refactoring ui.png",
            "refactoring ui.webp",
            "sprint.png",
            "sprint.webp",
            "the design of everyday things.png",
            "the design of everyday things.webp",
            "the mom test.png",
            "the mom test.webp",
            "the user experience team of one .png",
            "the user experience team of one .webp",
            "thinking fast and slow.png",
            "thinking fast and slow.webp",
            "turn the ship around.png",
            "turn the ship around.webp",
            "UI Design principles.png",
            "UI Design principles.webp",
            "universal methods of design.png",
            "universal methods of design.webp",
            "what color is your parachute.png",
            "what color is your parachute.webp"
        ];

        // BOOK DATA
        const books = [
            // DESIGN
            { title: "Don’t Make Me Think", author: "Steve Krug", year: 2023, status: "Read", category: "Design", note: "Classic intro to UX and usability." },
            { title: "The Design of Everyday Things", author: "Don Norman", year: 2025, status: "Read", category: "Design", note: "Started 2023, finished 2025. Fundamental thinking on how humans interact with the world." },
            { title: "Atomic Design", author: "Brad Frost", year: 2024, status: "Read", category: "Design", note: "Great intro to design systems and how they work." },
            { title: "Refactoring UI", author: "Adam Wathan & Steve Schoger", year: 2024, status: "Read", category: "Design", note: "Strong practical UI improvements and tactics." },
            { title: "UI Design Principles", author: "Michael Filipiuk", year: 2024, status: "Read", category: "Design", note: "Helpful fundamentals for clean interfaces." },
            { title: "The Graphic Designer’s Guide to Clients", author: "Ellen Shapiro", year: 2024, status: "Read", category: "Design", note: "Freelancer/client lessons. Older but useful." },
            { title: "Logo Design Inspiration (Market Find)", author: "", year: 2024, status: "Read", category: "Design", note: "Market find, used for logo inspiration.", coverHint: "logo design" },
            { title: "The User Experience Team of One", author: "Leah Buley", year: 2025, status: "Read", category: "Design", note: "Thriving as solo designer, stakeholders, process." },
            { title: "Practical UI", author: "Adam (unknown surname)", year: 2025, status: "Read", category: "Design", note: "Type scale, spacing systems, UI practice." },
            { title: "The Mom Test", author: "Rob Fitzpatrick", year: 2025, status: "Read", category: "Design", note: "Interviewing psychology + best practices." },
            { title: "Creative Selection: Inside Apple’s Design Process", author: "Ken Kocienda", year: 2025, status: "Read", category: "Design", note: "Apple design process insight from the inside." },
            { title: "Rave Art Flyers & Brochures", author: "", year: 2025, status: "Read", category: "Design", note: "Design inspiration + personal interest in birth of acid house.", coverHint: "rave art" },
            { title: "Universal Methods of Design (Pocket Edition)", author: "", year: 2025, status: "Read", category: "Design", note: "Sits on desk, referenced often.", coverHint: "universal methods of design" },
            { title: "Sprint", author: "Jake Knapp", year: 2025, status: "Read", category: "Design", note: "Product/design sprint framework." },
            { title: "Dictionary of Colour Combinations Vol. 2", author: "", year: 2025, status: "Read", category: "Design", note: "Desk reference for color palettes.", coverHint: "dictionary of colour combinations" },
            { title: "Happiness by Design", author: "Paul Dolan", year: 2025, status: "Read", category: "Design", note: "Psychology + emotion, useful for design thinking." },
            { title: "Just Enough Research", author: "Erika Hall", year: 2026, status: "Reading", category: "Design", note: "Essential guide to modern user research." },
            { title: "Inspired", author: "Marty Cagan", year: 2026, status: "To read", category: "Design", note: "Product management fundamentals." },
            { title: "Empowered", author: "Marty Cagan", year: 2026, status: "To read", category: "Design", note: "Leadership in product teams." },
            { title: "Lean UX", author: "", year: 2026, status: "To read", category: "Design", note: "Applying agile principles to user experience design." },
            { title: "Thinking, Fast and Slow", author: "Daniel Kahneman", year: 2026, status: "To read", category: "Design", note: "Cognitive biases and decision making." },
            { title: "Hooked", author: "Nir Eyal", year: 2026, status: "To read", category: "Design", note: "How to build habit-forming products." },
            { title: "Build", author: "Tony Fadell", year: 2025, status: "Read", category: "Design", note: "Inspired me to build my own business / startup." },
            { title: "Turn the Ship Around!", author: "L. David Marquet", year: 2025, status: "Read", category: "Design", note: "Leadership + ownership." },

            // OTHER
            { title: "Atomic Habits", author: "James Clear", year: 2024, status: "Read", category: "Other", note: "Started my reading habit, built strong foundations." },
            { title: "The Barefoot Investor", author: "Scott Pape", year: 2024, status: "Read", category: "Other", note: "Saving/debt/investing basics." },
            { title: "12 Rules for Life", author: "Jordan B. Peterson", year: 2024, status: "Read", category: "Other", note: "Life rules framework." },
            { title: "Overcoming Tendonitis", author: "", year: 2025, status: "Read", category: "Other", note: "Injury learning + rehab approach." },
            { title: "Overcoming Gravity", author: "Steven Low", year: 2025, status: "Read", category: "Other", note: "Calisthenics training deep dive." },
            { title: "Knee Ability Zero", author: "Ben Patrick", year: 2025, status: "Read", category: "Other", note: "Knee/ankle strength + mobility." },
            { title: "The 48 Laws of Power", author: "Robert Greene", year: 2025, status: "Read", category: "Other", note: "Power dynamics and strategy." },
            { title: "RecipeTin Eats: Tonight", author: "Nagi Maehashi", year: 2025, status: "Read", category: "Other", note: "Refer to it often for cooking.", coverHint: "recipetineeats tonight" },
            { title: "Never Split the Difference", author: "Chris Voss", year: 2026, status: "Reading", category: "Other", note: "Negotiation as if your life depended on it." }
        ];

        // STATE
        let currentSort = "desc";

        // HELPERS
        function slugify(text) {
            return text.toLowerCase().replace(/[^\w\s-]/g, '').trim().replace(/\s+/g, '-');
        }

        function levenshtein(a, b) {
            const matrix = [];
            for (let i = 0; i <= b.length; i++) matrix[i] = [i];
            for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) === a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
                    }
                }
            }
            return matrix[b.length][a.length];
        }

        function getCoverPath(book) {
            const rawHint = (book.coverHint || book.title).toLowerCase();
            // Replace curly quotes with straight ones for better matching
            const hint = rawHint.replace(/[‘’]/g, "'").replace(/[“”]/g, '"');
            
            // 1. Try to find include matches
            let match = availableCovers.find(filename => {
                const nameWithoutExt = filename.split('.')[0].toLowerCase().replace(/[‘’]/g, "'").replace(/[“”]/g, '"');
                return nameWithoutExt === hint || nameWithoutExt.includes(hint) || hint.includes(nameWithoutExt);
            });

            // 2. If no include match, try fuzzy matching
            if (!match) {
                let bestDist = Infinity;
                availableCovers.forEach(filename => {
                    const nameWithoutExt = filename.split('.')[0].toLowerCase();
                    const dist = levenshtein(hint, nameWithoutExt);
                    if (dist < hint.length * 0.4 && dist < bestDist) {
                        bestDist = dist;
                        match = filename;
                    }
                });
            }

            if (match) {
                // If we found a .png but a .webp version exists, use .webp
                const baseName = match.split('.')[0];
                const hasWebp = availableCovers.includes(`${baseName}.webp`);
                const finalFile = hasWebp ? `${baseName}.webp` : match;
                return `Book covers/${finalFile}`;
            }
            return null;
        }

        function getStatusPriority(status) {
            if (status === "Reading") return 3;
            if (status === "Read") return 2;
            return 1;
        }

        // RENDER
        function renderLibrary() {
            const container = document.getElementById('library-content');
            container.innerHTML = "";

            const timeline = document.createElement('div');
            timeline.className = "reading-timeline";
            container.appendChild(timeline);

            // Group all books by year
            const yearGroups = {};
            books.forEach(book => {
                if (!yearGroups[book.year]) yearGroups[book.year] = [];
                yearGroups[book.year].push(book);
            });

            // Get years sorted descending
            const years = Object.keys(yearGroups).sort((a, b) => b - a);

            years.forEach(year => {
                const yearSection = document.createElement('div');
                yearSection.className = "year-section";
                
                const yearMarker = document.createElement('div');
                yearMarker.className = "year-marker";
                yearMarker.innerHTML = `<span>${year}</span>`;
                yearSection.appendChild(yearMarker);

                const sortedBooks = yearGroups[year].sort((a, b) => getStatusPriority(b.status) - getStatusPriority(a.status));
                
                sortedBooks.forEach(book => {
                    const row = createBookRow(book);
                    yearSection.appendChild(row);
                });

                timeline.appendChild(yearSection);
            });

            // Initialize Animations
            initAnimations();
        }

        function createBookRow(book) {
            const row = document.createElement('div');
            row.className = "book-row";
            row.onclick = () => openModal(book);

            const coverPath = getCoverPath(book);
            const coverHtml = coverPath 
                ? `<img src="${coverPath}" alt="${book.title}" class="book-thumbnail" loading="lazy">`
                : `<div class="placeholder-cover" style="padding: 10px;">
                        <span style="font-size: 8px; font-weight: 800;">${book.title}</span>
                   </div>`;

            row.innerHTML = `
                <div class="book-thumbnail-wrap">
                    ${coverHtml}
                </div>
                <div class="book-details">
                    <div class="book-meta-top">
                        <span class="category-badge">${book.category}</span>
                        <span class="status-badge status-${book.status.replace(' ', '-')}">${book.status}</span>
                    </div>
                    <h3 class="row-title">${book.title}</h3>
                    <p class="row-author">${book.author ? 'by ' + book.author : ''}</p>
                </div>
            `;
            return row;
        }

        function initAnimations() {
            gsap.utils.toArray('.book-row').forEach((row, i) => {
                gsap.to(row, {
                    scrollTrigger: {
                        trigger: row,
                        start: "top 95%",
                        toggleActions: "play none none none"
                    },
                    opacity: 1,
                    x: 0,
                    filter: "blur(0px)",
                    duration: 1.2,
                    ease: "power3.out",
                    delay: (i % 2) * 0.1
                });
            });
        }

        // MODAL LOGIC
        function openModal(book) {
            const modal = document.getElementById('book-modal');
            const cover = document.getElementById('modal-cover');
            const status = document.getElementById('modal-status');
            const title = document.getElementById('modal-title');
            const author = document.getElementById('modal-author');
            const year = document.getElementById('modal-year');
            const category = document.getElementById('modal-category');
            const note = document.getElementById('modal-note');
            const noteContainer = document.getElementById('modal-note-container');

            const path = getCoverPath(book);
            if (path) {
                cover.src = path;
                cover.classList.remove('hidden');
            } else {
                cover.classList.add('hidden');
            }

            status.textContent = book.status;
            status.className = `book-status-chip status-${book.status.replace(' ', '-')}`;
            title.textContent = book.title;
            author.textContent = book.author ? `by ${book.author}` : "";
            year.textContent = `Year: ${book.year}`;
            category.textContent = book.category;
            
            if (book.note) {
                note.textContent = book.note;
                noteContainer.classList.remove('hidden');
            } else {
                noteContainer.classList.add('hidden');
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(e) {
            document.getElementById('book-modal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // THEME TOGGLE
        function toggleTheme() {
            const current = document.body.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const icon = document.getElementById('theme-icon');
            const theme = document.body.getAttribute('data-theme');
            if (theme === 'dark') {
                icon.innerHTML = '<path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>';
            } else {
                icon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
            }
        }

        // INIT
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            updateThemeIcon();
            renderLibrary();
        });
    </script>
</body>
</html>
